<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>News Details</title>
<style>
  body{font-family:'Segoe UI',Arial,sans-serif;background:#f6fbff;margin:0;padding:20px}
  .card{max-width:900px;margin:30px auto;background:#fff;padding:22px;border-radius:12px;box-shadow:0 8px 25px rgba(0,0,0,0.08)}
  .title{color:#0077b6;font-size:1.6rem;font-weight:700;margin-bottom:6px}
  .meta{color:#666;font-size:.95rem;margin-bottom:12px}
  .image{width:100%;max-height:420px;object-fit:cover;border-radius:8px;margin-bottom:12px}
  .content{line-height:1.6;color:#222}
  .tags{margin-top:14px}
  .badge{display:inline-block;background:#eef7ff;padding:6px 10px;border-radius:999px;margin-right:8px;font-weight:600;color:#0077b6}
  .actions{margin-top:18px}
  button{padding:8px 14px;border-radius:999px;border:0;cursor:pointer;font-weight:700}
  .verify{background:#f0ad4e;color:#fff}
  .approved{background:#28a745;color:#fff}
</style>
</head>
<body>
  <div class="card" id="card">
    <div id="loading">Loading...</div>
    <div id="content" style="display:none">
      <div class="title" id="title"></div>
      <div class="meta" id="meta"></div>
      <img id="image" class="image" src="" alt="" style="display:none"/>
      <div class="content" id="body"></div>
      <div class="tags">
        <span class="badge" id="category"></span>
        <span class="badge" id="location"></span>
      </div>
      <div class="actions">
        <button id="verifyBtn" class="verify">Verify</button>
        <button id="approveBtn" class="approve">Approve</button>
      </div>
    </div>
  </div>

<script>
function qs(key){ const u = new URLSearchParams(location.search); return u.get(key); }
const id = qs('id');
if(!id){ document.getElementById('loading').innerText = 'No article selected.'; }

async function load() {
  try {
    const res = await fetch('/api/news/' + id);
    if(!res.ok) { document.getElementById('loading').innerText = 'Article not found.'; return; }
    const data = await res.json();
    document.getElementById('loading').style.display = 'none';
    document.getElementById('content').style.display = 'block';
    document.getElementById('title').innerText = data.title || 'No title';
    const meta = `${new Date(data.date || data.createdAt).toLocaleString()} â€¢ ${data.email || ''}`;
    document.getElementById('meta').innerText = meta;
    if(data.image){ const img = document.getElementById('image'); img.src = data.image; img.style.display = 'block'; img.alt = data.title || ''; }
    document.getElementById('body').innerText = data.description || data.content || '';
    document.getElementById('category').innerText = data.category || 'General';
    document.getElementById('location').innerText = data.location || 'Unknown';
    const verifyBtn = document.getElementById('verifyBtn');
    const approveBtn = document.getElementById('approveBtn');
    verifyBtn.textContent = data.verified ? 'Verified' : 'Verify';
    approveBtn.textContent = data.approved ? 'Approved' : 'Approve';
    if(data.verified) verifyBtn.disabled = true;
    if(data.approved) approveBtn.disabled = true;

    verifyBtn.addEventListener('click', async () => {
      try {
        const r = await fetch('/api/news/' + id + '/verify', { method: 'PATCH' });
        const updated = await r.json();
        verifyBtn.textContent = 'Verified'; verifyBtn.disabled = true;
      } catch(err){ alert('Verify failed'); console.error(err); }
    });

    approveBtn.addEventListener('click', async () => {
      try {
        const r = await fetch('/api/news/' + id + '/approve', { method: 'PATCH' });
        const updated = await r.json();
        approveBtn.textContent = 'Approved'; approveBtn.disabled = true;
      } catch(err){ alert('Approve failed'); console.error(err); }
    });

  } catch (err) {
    console.error(err);
    document.getElementById('loading').innerText = 'Error loading article';
  }
}

load();
</script>
</body>
</html>
